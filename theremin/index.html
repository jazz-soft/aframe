<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
<script>
const AC = window.AudioContext || window.webkitAudioContext;
const ac = new AC();
const logA = Math.log(40);
const logB = Math.log(14000);

var moog = {
  boxwidth: 0.455,
  boxheight: 0.07,
  boxdepth: 0.14,
  antlength: 0.46,
  antradius: 0.006,
  antdx: 0.015,
  antdz: -0.02
};
AFRAME.registerComponent('theremin', {
  init: function () {
    this.gain = ac.createGain();
    this.gain.connect(ac.destination);
    this.osc = ac.createOscillator();
    this.osc.type = 'sine';
    this.osc.frequency.value = 0;
    this.osc.connect(this.gain);
    this.osc.start();

    this.v3 = new THREE.Vector3();
    this.lefthand = document.querySelector('#left');
    this.righthand = document.querySelector('#right');
    this.text = document.querySelector('#text');

    this.trkr = document.querySelector('#leftt');
    this.trkl = document.querySelector('#rightt');

    this.box = document.createElement('a-entity');
    this.box.setAttribute('geometry', { primitive: 'box', width: moog.boxwidth, height: moog.boxheight, depth: moog.boxdepth });
    this.box.setAttribute('material', { color: 'brown' });
    this.el.appendChild(this.box);

    this.right = document.createElement('a-entity');
    this.right.setAttribute('geometry', { primitive: 'cylinder', height: moog.antlength, radius: moog.antradius });
    this.right.setAttribute('position', { x: moog.boxwidth / 2 + moog.antdx, y: moog.antlength / 2, z: moog.antdz });
    this.right.setAttribute('material', { color: 'gray' });
    this.el.appendChild(this.right);

    this.left = document.createElement('a-entity');
    this.left.setAttribute('geometry', { primitive: 'cylinder', height: moog.antlength, radius: moog.antradius });
    this.left.setAttribute('position', { x: - moog.boxwidth, y: 0, z: - moog.antdz });
    this.left.setAttribute('rotation', { x: 0, y: 0, z: 90 });
    this.left.setAttribute('material', { color: 'gray' });
    this.el.appendChild(this.left);
  },
  tick: function(t, dt) {
    var lp = this.lefthand.getAttribute('position');
    var lr = this.lefthand.getAttribute('rotation');
    var rp = this.righthand.getAttribute('position');
    var rr = this.righthand.getAttribute('rotation');
var pp = this.el.getAttribute('position');
    if (lp.x || lp.y || lp.z || rp.x || rp.y || rp.z) {
      if (ac.state === 'suspended')  ac.resume();


      var txt = 'left: x=' + lp.x.toFixed(3) + ' y=' + lp.y.toFixed(3) + ' z=' + lp.z.toFixed(3) +
             '\nrot: x=' + lr.x.toFixed(3) + ' y=' + lr.y.toFixed(3) + ' z=' + lr.z.toFixed(3) +
             '\nright: x=' + rp.x.toFixed(3) + ' y=' + rp.y.toFixed(3) + ' z=' + rp.z.toFixed(3) +
             '\nrot: x=' + rr.x.toFixed(3) + ' y=' + rr.y.toFixed(3) + ' z=' + rr.z.toFixed(3);
      this.text.setAttribute('text', { 'value': txt });
      //this.trkr.setAttribute('position', { x: rp.x, y: rp.y, z: rp.z });
    }
  }
});
</script>
</head>
<body>
<a-scene>

 <a-sky color="#aaa"></a-sky>
 <a-entity id="left" hand-controls="hand:left;color:#f80">
   <a-entity id="leftt" geometry="primitive:sphere; radius: 0.03; color:#ff0000" position="0 0 -0.1"></a-entity>
 </a-entity>
 <a-entity id="right" hand-controls="hand:right;color:#f80">
   <a-entity id="rightt" geometry="primitive:sphere; radius: 0.03"; position="0 0 -0.1"></a-entity>
 </a-entity>
 <a-entity theremin position="0 1.2 -1"></a-entity>
 <a-entity geometry="primitive: cylinder; height: 1.2; radius: 0.01" position="0 0.6 -1" material="color:black"></a-entity>
 <a-entity geometry="primitive: cylinder; height: 0.03; radius: 0.2" position="0 0 -1" material="color:black"></a-entity>

 <a-entity id="camera" camera look-controls wasd-controls>
  <a-entity id="text" text="align:center;" position="0 0 -.5"></a-entity>
 </a-entity>

</a-scene>
<script>
var text = document.querySelector('#text');
text.setAttribute('text', { 'value': 'This app requires hand controls!' });
</script>
</body>
</html>
